package fr.vco.codingame.puzzles.voxcodei.episode2

import io.kotest.core.spec.style.FunSpec
import io.kotest.matchers.collections.shouldNotContainOnly
import io.kotest.matchers.shouldNotBe

data class GameInput( val width: Int, val height: Int, val turns: Int, val bombs: Int, val grids: List<List<String>>)

class Test : FunSpec ({


    listOf(
        GameInput( 12, 9,  30, 1 , listOf(listOf(
            "............",
            "............",
            "............",
            "............",
            ".@..........",
            "............",
            "............",
            "............",
            "............",
        ), listOf(
            "............",
            "............",
            "............",
            "............",
            "..@.........",
            "............",
            "............",
            "............",
            "............",
        ))),
        GameInput( 12, 9,  99, 9 , listOf(listOf(
            ".#.@........",
            "..#......@..",
            "......@..#..",
            ".....@....#.",
            "....@...#...",
            "...@.......#",
            "..@......#..",
            ".@......#...",
            "@......#....",
        ), listOf(
            ".#..@.......",
            "..#.....@...",
            ".......@.#..",
            "......@...#.",
            ".....@..#...",
            "....@......#",
            "...@.....#..",
            "..@.....#...",
            ".@.....#....",
        ), listOf(
            ".#...@......",
            "..#....@....",
            "........@#..",
            ".......@..#.",
            "......@.#...",
            ".....@.....#",
            "....@....#..",
            "...@....#...",
            "..@....#....",
        ), listOf(
            ".#....@.....",
            "..#...@.....",
            ".......@.#..",
            "........@.#.",
            ".......@#...",
            "......@....#",
            ".....@...#..",
            "....@...#...",
            "...@...#....",
        ), listOf(
            ".#.....@....",
            "..#..@......",
            "......@..#..",
            ".........@#.",
            "......@.#...",
            ".......@...#",
            "......@..#..",
            ".....@..#...",
            "....@..#....",
        ), listOf(
            ".#......@...",
            "..#.@.......",
            ".....@...#..",
            "........@.#.",
            ".....@..#...",
            "........@..#",
            ".......@.#..",
            "......@.#...",
            ".....@.#....",
        ), listOf(
            ".#.......@..",
            "..#@........",
            "....@....#..",
            ".......@..#.",
            "....@...#...",
            ".........@.#",
            "........@#..",
            ".......@#...",
            "......@#....",
        ), listOf(
            ".#........@.",
            "..#.@.......",
            "...@.....#..",
            "......@...#.",
            "...@....#...",
            "..........@#",
            ".......@.#..",
            "......@.#...",
            ".....@.#....",
        ), listOf(
            ".#.........@",
            "..#..@......",
            "..@......#..",
            ".....@....#.",
            "..@.....#...",
            ".........@.#",
            "......@..#..",
            ".....@..#...",
            "....@..#....",
        ), listOf(
            ".#........@.",
            "..#...@.....",
            ".@.......#..",
            "....@.....#.",
            ".@......#...",
            "........@..#",
            ".....@...#..",
            "....@...#...",
            "...@...#....",
        ))),
        GameInput( 12, 9,  60, 4 , listOf(listOf(
            "........@...",
            ".......@....",
            ".#.#.#@#.#.#",
            ".....@......",
            "#.#.@#..#.#.",
            "...@........",
            "..@.........",
            ".@..........",
            "@...........",
        ), listOf(
            ".......@....",
            "........@...",
            ".#.#.#.#.#.#",
            "....@.@.....",
            "#.#..#..#.#.",
            "..@.........",
            "...@........",
            "............",
            ".@..........",
        ), listOf(
            "......@.....",
            ".........@..",
            ".#.#@#.#.#.#",
            ".......@....",
            "#.#..#@.#.#.",
            ".@..........",
            "....@.......",
            ".@..........",
            "..@.........",
        ))),
        GameInput( 12, 9,  90, 3 , listOf(listOf(
            "@...........",
            ".....@....@.",
            "@...........",
            ".....@......",
            "..@.@.@.@...",
            ".....@......",
            "............",
            ".@...@......",
            ".........@.@",
        ), listOf(
            ".@..........",
            ".....@....@.",
            "............",
            "@....@......",
            "..@.@.@.@...",
            ".....@......",
            "............",
            ".@...@.....@",
            "........@...",
        ))),
        GameInput( 16, 12,  98, 10 , listOf(listOf(
            "##..@...##@@@.@@",
            "##.....#.##..@..",
            "..#...#..#######",
            "...#@#...##@...#",
            "@..@.@..@#....#.",
            "...#@#####...#..",
            "..#...#...#@#...",
            ".#....#@..@.@..@",
            "#...@.##..#@#...",
            "#######@##...#..",
            "......@.@#....##",
            "@.........#@..#.",
        ), listOf(
            "##.@....##@@@.@@",
            "##.....#.##.@...",
            "..#...#..#######",
            "...#@#..@##.@..#",
            "...@.@...#....#.",
            "@..#@#####...#..",
            "..#...#@..#@#...",
            ".#....#...@.@...",
            "#..@..##..#@#..@",
            "#######@##...#..",
            "......@.@#....##",
            ".@........#.@.#.",
        ), listOf(
            "##@.....##@@@.@@",
            "##.....#.##@....",
            "..#...#.@#######",
            "...#@#...##..@.#",
            "...@.@...#....#.",
            "...#@#####...#..",
            "@.#...#...#@#...",
            ".#....#@..@.@...",
            "#.@...##..#@#...",
            "#######@##...#.@",
            "......@.@#....##",
            "..@.......#..@#.",
        ), listOf(
            "##.@....##@@@.@@",
            "##.....#@##.@...",
            "..#...#..#######",
            "...#@#...##...@#",
            "...@.@...#....#.",
            "...#@#####...#..",
            "..#...#@..#@#...",
            "@#....#...@.@...",
            "#@....##..#@#..@",
            "#######@##...#..",
            "......@.@#....##",
            "...@......#.@.#.",
        ), listOf(
            "##..@...##@@@.@@",
            "##.....#.##..@..",
            "..#...#.@#######",
            "...#@#...##..@.#",
            "...@.@...#....#.",
            "...#@#####...#..",
            "@.#...#...#@#...",
            ".#....#@..@.@..@",
            "#.@...##..#@#...",
            "#######@##...#..",
            "......@.@#....##",
            "....@.....#@..#.",
         ), listOf(
            "##...@..##@@@.@@",
            "##.....#.##...@.",
            "..#...#..#######",
            "...#@#..@##.@..#",
            "...@.@...#....#.",
            "@..#@#####...#..",
            "..#...#@..#@#..@",
            ".#....#...@.@...",
            "#..@..##..#@#...",
            "#######@##...#..",
            "......@.@#....##",
            ".....@....#.@.#.",
        ))),
    ).forEachIndexed{i, ( width, height, turns, bombs, grids) ->

        val sequenceReader = sequence{
            grids.forEachIndexed{ i, grid ->
                yield("${turns-i} $bombs")
                grid.forEach{ line -> yield(line)}
            }
        }

        test("Game $i") {
            val gridBuilder = SimulatorBuilder(width, height, sequenceReader.iterator()::next)
            val simulator = gridBuilder.buildSimulator()

            val resolver = GameResolver(simulator)
            val actions = resolver.resolve()

            System.err.println("$actions")
            actions shouldNotBe emptyList<Int>()
            actions.shouldNotContainOnly(-1)
        }
    }

})